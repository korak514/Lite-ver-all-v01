<UserControl x:Class="WPF_LoginForm.Views.ErrorManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             mc:Ignorable="d"
             d:DesignHeight="650" d:DesignWidth="1100">

    <Grid Background="#09092B">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="240" />
        </Grid.ColumnDefinitions>

        <!-- COL 0: Stacked Pie Charts -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Machine Pie -->
            <Border Grid.Row="0" Margin="0,0,5,10" Background="#181838" CornerRadius="10" Padding="10">
                <Grid>
                    <TextBlock Text="By Machine (Top 9)" Foreground="LightGray" FontWeight="Bold" VerticalAlignment="Top" />
                    <lvc:PieChart Series="{Binding MachineSeries}" LegendLocation="Right" InnerRadius="0" Hoverable="True"
                                  DataClickCommand="{Binding ChartClickCommand}" Margin="0,20,0,0">
                        <lvc:PieChart.DataTooltip>
                            <lvc:DefaultTooltip SelectionMode="OnlySender" />
                        </lvc:PieChart.DataTooltip>
                        <lvc:PieChart.ChartLegend>
                            <lvc:DefaultLegend Foreground="#CCCCCC" FontSize="11" />
                        </lvc:PieChart.ChartLegend>
                    </lvc:PieChart>
                </Grid>
            </Border>

            <!-- Shift Pie -->
            <Border Grid.Row="1" Margin="0,0,5,0" Background="#181838" CornerRadius="10" Padding="10">
                <Grid>
                    <TextBlock Text="Duraklama Süresi (By Shift)" Foreground="LightGray" FontWeight="Bold" VerticalAlignment="Top" />
                    <lvc:PieChart Series="{Binding ShiftSeries}" LegendLocation="Bottom" InnerRadius="40" Hoverable="True"
                                  DataClickCommand="{Binding ChartClickCommand}" Margin="0,20,0,0">
                        <lvc:PieChart.DataTooltip>
                            <lvc:DefaultTooltip SelectionMode="OnlySender" />
                        </lvc:PieChart.DataTooltip>
                        <lvc:PieChart.ChartLegend>
                            <lvc:DefaultLegend Foreground="#CCCCCC" FontSize="12" />
                        </lvc:PieChart.ChartLegend>
                    </lvc:PieChart>
                </Grid>
            </Border>
        </Grid>

        <!-- COL 1: Main Bar Chart -->
        <Border Grid.Column="1" Margin="5,10,5,10" Background="#181838" CornerRadius="10" Padding="15">
            <Grid>
                <!-- Updated Title -->
                <TextBlock Text="Longest Single Downtime Events (Max Minutes)" Foreground="White" FontSize="16" FontWeight="SemiBold" />

                <lvc:CartesianChart Series="{Binding ReasonSeries}" LegendLocation="None" DataClickCommand="{Binding ChartClickCommand}" Margin="10,35,10,25">
                    <lvc:CartesianChart.AxisX>
                        <lvc:Axis Labels="{Binding ReasonLabels}" Foreground="White" FontSize="11">
                            <lvc:Axis.Separator>
                                <lvc:Separator Step="1" StrokeThickness="0" />
                            </lvc:Axis.Separator>
                        </lvc:Axis>
                    </lvc:CartesianChart.AxisX>
                    <lvc:CartesianChart.AxisY>
                        <lvc:Axis LabelFormatter="{Binding NumberFormatter}" Foreground="White">
                            <lvc:Axis.Separator>
                                <lvc:Separator Stroke="#303030" />
                            </lvc:Axis.Separator>
                        </lvc:Axis>
                    </lvc:CartesianChart.AxisY>
                </lvc:CartesianChart>
            </Grid>
        </Border>

        <!-- COL 2: Controls & Slider (Right Side) -->
        <Border Grid.Column="2" Background="#101030" BorderBrush="#333" BorderThickness="1,0,0,0" Padding="15">
            <StackPanel>
                <TextBlock Text="Data Controls" Foreground="#0078D7" FontSize="18" FontWeight="Bold" Margin="0,0,0,20" />

                <TextBlock Text="Select Table:" Foreground="Gray" Margin="0,0,0,5" />
                <ComboBox ItemsSource="{Binding TableNames}" SelectedItem="{Binding SelectedTable}" Height="30" Margin="0,0,0,15" VerticalContentAlignment="Center" Padding="5" />

                <!-- NEW: Exclude MA-00 Checkbox -->
                <CheckBox Content="Exclude MA-00 (Lunch/Breaks)"
                          IsChecked="{Binding IsMachine00Excluded}"
                          Foreground="WhiteSmoke"
                          Margin="0,0,0,20"
                          ToolTip="Hides generic stops (Cleaning, Lunch, etc) from charts" />

                <TextBlock Text="Start Date:" Foreground="Gray" Margin="0,0,0,5" />
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="25" />
                        <ColumnDefinition Width="25" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="25" />
                        <ColumnDefinition Width="25" />
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0" Content="&lt;&lt;" Command="{Binding MoveDateCommand}" CommandParameter="Start|-7" Background="#333" Foreground="White" BorderThickness="0" Cursor="Hand" />
                    <Button Grid.Column="1" Content="&lt;" Command="{Binding MoveDateCommand}" CommandParameter="Start|-1" Background="#444" Foreground="White" BorderThickness="0" Cursor="Hand" />
                    <DatePicker Grid.Column="2" SelectedDate="{Binding StartDate}" VerticalContentAlignment="Center" />
                    <Button Grid.Column="3" Content="&gt;" Command="{Binding MoveDateCommand}" CommandParameter="Start|1" Background="#444" Foreground="White" BorderThickness="0" Cursor="Hand" />
                    <Button Grid.Column="4" Content="&gt;&gt;" Command="{Binding MoveDateCommand}" CommandParameter="Start|7" Background="#333" Foreground="White" BorderThickness="0" Cursor="Hand" />
                </Grid>

                <TextBlock Text="End Date:" Foreground="Gray" Margin="0,0,0,5" />
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="25" />
                        <ColumnDefinition Width="25" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="25" />
                        <ColumnDefinition Width="25" />
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0" Content="&lt;&lt;" Command="{Binding MoveDateCommand}" CommandParameter="End|-7" Background="#333" Foreground="White" BorderThickness="0" Cursor="Hand" />
                    <Button Grid.Column="1" Content="&lt;" Command="{Binding MoveDateCommand}" CommandParameter="End|-1" Background="#444" Foreground="White" BorderThickness="0" Cursor="Hand" />
                    <DatePicker Grid.Column="2" SelectedDate="{Binding EndDate}" VerticalContentAlignment="Center" />
                    <Button Grid.Column="3" Content="&gt;" Command="{Binding MoveDateCommand}" CommandParameter="End|1" Background="#444" Foreground="White" BorderThickness="0" Cursor="Hand" />
                    <Button Grid.Column="4" Content="&gt;&gt;" Command="{Binding MoveDateCommand}" CommandParameter="End|7" Background="#333" Foreground="White" BorderThickness="0" Cursor="Hand" />
                </Grid>

                <TextBlock Text="Time Range:" Foreground="Gray" Margin="0,0,0,10" />
                <xctk:RangeSlider Minimum="{Binding SliderMinimum}" Maximum="{Binding SliderMaximum}" LowerValue="{Binding SliderLowValue}" HigherValue="{Binding SliderHighValue}" Height="30" Margin="0,0,0,25" />

                <Button Content="REFRESH DATA" Command="{Binding LoadDataCommand}" Height="45" Background="#FF0078D7" Foreground="White" FontWeight="Bold" FontSize="14" BorderThickness="0" Cursor="Hand">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5" />
                        </Style>
                    </Button.Resources>
                </Button>

                <TextBlock Text="* Bar Chart shows longest single incident." Foreground="#666" FontSize="11" TextWrapping="Wrap" Margin="0,20,0,0" FontStyle="Italic" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>